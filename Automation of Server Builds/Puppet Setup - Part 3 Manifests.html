<p style=""><img class="fr-dib fr-draggable" src="/uploads/blogs/automation_of_server_builds/creating_manifests/puppet.png" style="width: 300px;"></p><h1>Creating Manifests</h1><p>Firstly we should understand what a manifests is and what it does. &nbsp;Firstly its a .pp file, the file contains things like Node definitions, Resource Declarations, Variables and Classes. &nbsp;These are what tells puppet how to configure the server that the agent is on. &nbsp;I show also say that when we are talking about Classes they are different to the Class you would be thinking about if you where use to object-oriented programming, a puppet class is just a named collection of Resource Declarations, Variables, Selectors and any other puppet code.</p><p><br></p><h2>Pre-req&#39;s</h2><p>For this example I need to install a module. &nbsp;This module will allow you to deploy code from github.</p><pre class="  language-bash"><code class=" language-bash"><span class="token function">sudo</span> puppet module <span class="token function">install</span> puppetlabs/vcsrepo</code><code class=" language-bash"><span class="token function">cd</span> /etc/puppet/environments/production/module</code><code class=" language-bash"><span class="token function">sudo</span> puppet module generate pd-git</code></pre><p>Don&#39;t worry too much about this, when you type in the second command it will ask about 7 questions, you can leave the defaults in most or blank, its fine. &nbsp;For this example it doesn&#39;t really matter.</p><p>Next you want to edit <code>/etc/puppet/environments/production/modules/pd-git/manifests/init.pp</code></p><p>At the bottom of the file you will find a class called git and you just want to put another class into that:</p><pre class=" language-bash"><code class=" language-bash">class <span class="token function">git</span> <span class="token punctuation">{</span></code><code class=" language-bash">&nbsp; &nbsp; class <span class="token punctuation">{</span> git::clone: <span class="token punctuation">}</span></code><code class=" language-bash"><span class="token punctuation">}</span></code></pre><p>The next file is <code>/etc/puppet/environments/production/modules/pd-git/manifests/clone.pp</code></p><p><br></p><pre class=" language-bash" style=""><code class=" language-bash">class git::clone <span class="token punctuation">(</span><span class="token variable">$repo</span>, <span class="token variable">$username</span><span class="token operator">=</span><span class="token string">&#39;www-user&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code><code class=" language-bash">&nbsp; &nbsp; <span class="token variable">$group</span> <span class="token operator">=</span> <span class="token variable">$username</span></code><code class=" language-bash">&nbsp; &nbsp; group <span class="token punctuation">{</span> <span class="token variable">$username</span><span class="token keyword">:</span></code><code class=" language-bash">&nbsp; &nbsp; &nbsp; &nbsp; ensure &nbsp;<span class="token operator">=</span><span class="token operator">&gt;</span> present,</code><code class=" language-bash">&nbsp; &nbsp; &nbsp; &nbsp; gid &nbsp; &nbsp; <span class="token operator">=</span><span class="token operator">&gt;</span> 2000,</code><code class=" language-bash">&nbsp; &nbsp; <span class="token punctuation">}</span></code><code class=" language-bash">&nbsp; &nbsp; user <span class="token punctuation">{</span>&nbsp;</code><code class=" language-bash"><span class="token variable">&nbsp; &nbsp; &nbsp; $username</span><span class="token keyword">:</span></code><code class=" language-bash">&nbsp; &nbsp; &nbsp; &nbsp; ensure &nbsp;<span class="token operator">=</span><span class="token operator">&gt;</span> present,</code><code class=" language-bash">&nbsp; &nbsp; &nbsp; &nbsp; gid &nbsp; &nbsp; <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$group</span>,</code><code class=" language-bash">&nbsp; &nbsp; &nbsp; &nbsp; require <span class="token operator">=</span><span class="token operator">&gt;</span> Group<span class="token punctuation">[</span><span class="token variable">$group</span><span class="token punctuation">]</span>,</code><code class=" language-bash">&nbsp; &nbsp; &nbsp; &nbsp; uid &nbsp; &nbsp; <span class="token operator">=</span><span class="token operator">&gt;</span> 2000,</code><code class=" language-bash">&nbsp; &nbsp; &nbsp; &nbsp; home &nbsp; &nbsp;<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;/home/<span class="token variable">${username}</span>&quot;</span>,</code><code class=" language-bash">&nbsp; &nbsp; &nbsp; &nbsp; shell &nbsp; <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;/bin/bash&quot;</span>,</code><code class=" language-bash">&nbsp; &nbsp; &nbsp; &nbsp; managehome &nbsp;<span class="token operator">=</span><span class="token operator">&gt;</span> true,</code><code class=" language-bash">&nbsp; &nbsp; <span class="token punctuation">}</span></code><code class=" language-bash">&nbsp; &nbsp; <span class="token function">file</span> <span class="token punctuation">{</span> <span class="token string">&#39;/home/<span class="token variable">${username}</span>&#39;</span><span class="token keyword">:</span></code><code class=" language-bash">&nbsp; &nbsp; &nbsp; &nbsp; ensure &nbsp;<span class="token operator">=</span><span class="token operator">&gt;</span> directory,</code><code class=" language-bash">&nbsp; &nbsp; &nbsp; &nbsp; group &nbsp; <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$group</span>,</code><code class=" language-bash">&nbsp; &nbsp; &nbsp; &nbsp; owner &nbsp; <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$username</span>,</code><code class=" language-bash">&nbsp; &nbsp; &nbsp; &nbsp; mode &nbsp; &nbsp;<span class="token operator">=</span><span class="token operator">&gt;</span> 0700,</code><code class=" language-bash">&nbsp; &nbsp; <span class="token punctuation">}</span></code><code class=" language-bash">&nbsp; &nbsp; package <span class="token punctuation">{</span></code>
<code class=" language-bash"><span class="token string">&#39;git&#39;</span><span class="token keyword">:</span></code><code class=" language-bash">&nbsp; &nbsp; &nbsp; &nbsp; ensure <span class="token operator">=</span><span class="token operator">&gt;</span> installed,</code>
<code class=" language-bash">&nbsp; &nbsp; <span class="token punctuation">}</span></code>
<code class=" language-bash">&nbsp; &nbsp; &nbsp; &nbsp; vcsrepo <span class="token punctuation">{</span>&nbsp;</code><code class=" language-bash"><span class="token string">&nbsp; &nbsp; &quot;/opt/code/<span class="token variable">${repo}</span>&quot;</span><span class="token keyword">:</span></code><code class=" language-bash">&nbsp; &nbsp; &nbsp; &nbsp; ensure &nbsp; <span class="token operator">=</span><span class="token operator">&gt;</span> latest,</code><code class=" language-bash">&nbsp; &nbsp; &nbsp; &nbsp; owner &nbsp; &nbsp;<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$owner</span>,</code><code class=" language-bash">&nbsp; &nbsp; &nbsp; &nbsp; group &nbsp; &nbsp;<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$owner</span>,</code><code class=" language-bash">&nbsp; &nbsp; &nbsp; &nbsp; provider <span class="token operator">=</span><span class="token operator">&gt;</span> git,</code><code class=" language-bash">&nbsp; &nbsp; &nbsp; &nbsp; require &nbsp;<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span> Package<span class="token punctuation">[</span><span class="token string">&quot;git&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">]</span>,</code><code class=" language-bash">&nbsp; &nbsp; &nbsp; &nbsp; <span class="token function">source</span>&nbsp; &nbsp;<span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;http://giturl.com/proj/<span class="token variable">${repo}</span>.git&quot;</span>,</code><code class=" language-bash">&nbsp; &nbsp; &nbsp; &nbsp; revision <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&#39;master&#39;</span>,</code><code class=" language-bash">&nbsp; &nbsp; <span class="token punctuation">}</span></code><code class=" language-bash"><span class="token punctuation">}</span></code></pre><p style="">&nbsp;</p><h2 style="">Nodes</h2><p style="">First thing we are going to do is create a nodes.pp file, so on the puppet master and run:</p><p style="">nano /etc/puppet/environments/production/manifests/nodes.pp</p><p style=""><br></p><p style=""><br></p><p style=""><br></p><p style=""><br></p><p style=""><br></p><p style=""><br></p><p style=""><br></p><p style=""><br></p><p style=""><br></p><p style=""><br></p><p style=""><br></p><p><br></p><p><br></p>